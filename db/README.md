# 数据库迁移文件夹 - 数据结构说明

本文件夹包含了成渝地区高铁客运系统的核心数据文件，共 4 个主要 CSV 数据表。以下是各表的详细结构说明。

## 1. 高铁客运量表
**文件名**: `高铁客运量（成都--重庆）.csv`

### 描述
记录成都-重庆线路上的高铁客运流量、列车班次、票务和收入信息。这是系统的核心数据表，包含每班列车在各站点的详细运营和客流数据。

### 主要字段说明

| 字段编码 | 中文名称 | 数据类型 | 说明 |
|---------|---------|---------|------|
| xh | 序号 | 整数 | 数据记录的唯一序列号 |
| yyxlbm | 运营线路编码 | 整数 | 标识特定的运营线路（如成都-重庆线） |
| lcbm | 列车编码 | 整数 | 列车的内部编码，唯一标识每班列车 |
| zdid | 站点id | 整数 | 列车停靠站点的唯一标识符 |
| xlzdid | 线路站点id | 整数/NULL | 在特定线路上的站点排序号 |
| yxrq | 运行日期 | 日期 (YYYYMMDD) | 列车实际运行的日期 |
| ddsj | 到达时间 | 时间 (HHMM) | 列车在此站点的到达时间 |
| cfsj | 出发时间 | 时间 (HHMM) | 列车在此站点的出发时间 |
| skl | 上客量 | 整数 | 在此站点上车的乘客人数 |
| xkl | 下客量 | 整数 | 在此站点下车的乘客人数 |
| ticket_price | 车票价格 | 浮点数 | 该车次该站点的票价（元） |
| start_station_telecode | 起点站电报码 | 字符(3) | 起点站的标准电报代码（如 CDW） |
| end_station_telecode | 终点站电报码 | 字符(3) | 终点站的标准电报代码（如 CUW） |
| shouru | 收入 | 浮点数 | 该班次在此站点的收入金额（元） |

---

## 2. 客运站点表
**文件名**: `客运站点（站点名称、站点编号、备注）.csv`

### 描述
包含铁路网络中所有客运站点的基本信息。作为维度表，为其他表提供站点的参考数据。

### 主要字段说明

| 字段编码 | 中文名称 | 数据类型 | 说明 |
|---------|---------|---------|------|
| zdid | 站点id | 整数 | 站点的唯一标识符（主键） |
| lxid | 旅行区id | 整数 | 站点所属的旅行区编号 |
| zdmc | 站点名称 | 字符串 | 站点的中文名称，如"北京"、"成都"等 |
| station_code | 站点代码 | 整数 | 标准的站点代码 |
| station_telecode | 站点电报码 | 字符(3) | 国际标准电报代码，如 BJP(北京)、CDW(成都)、CUW(重庆) |
| station_shortname | 站点简称 | 字符(1-2) | 站点的简称，如"京"代表北京 |

### 数据示例
```
站点id: 1
名称: 北京
电报码: BJP
简称: 京
```

---

## 3. 列车表
**文件名**: `列车表（列车编码、列车代码、列车运量）.csv`

### 描述
存储列车的基本信息，包括列车编码、代码和运输容量。作为维度表，为其他表提供列车的参考数据。

### 主要字段说明

| 字段编码 | 中文名称 | 数据类型 | 说明 |
|---------|---------|---------|------|
| lcbm | 列车编码 | 整数 | 列车的唯一内部编码（主键） |
| lcdm | 列车代码 | 字符串 | 列车的运行代码，如"Z95"(特快列车) |
| lcyn | 列车运量 | 整数 | 该列车的总定员容量（座位数） |

### 数据示例
```
列车编码: 1
列车代码: Z95
运量: 1683 座
```

---

## 4. 运营线路客运站表
**文件名**: `运营线路客运站（运营线路编码、站点id...）.csv`

### 描述
定义了运营线路上的站点序列关系，记录了线路中各站点的位置和相邻关系。

### 主要字段说明

| 字段编码 | 中文名称 | 数据类型 | 说明 |
|---------|---------|---------|------|
| yyxlbm | 运营线路编码 | 整数 | 运营线路的唯一标识符 |
| zdid | 站点id | 整数 | 当前站点的id |
| xlzdid | 线路站点id | 整数 | 站点在线路上的序列号 |
| Q_zdid | 上一站id | 整数 | 前一个站点的id |
| yqzdjjl | 运营线路站间距离 | 整数 | 当前站与上一站的距离（公里） |
| H_zdid | 下一站id | 整数 | 后一个站点的id |
| sfqszd | 是否起始站点 | 二进制 (0/1) | 1 表示为起点站 |
| sfzdzd | 是否终点站点 | 二进制 (0/1) | 1 表示为终点站 |
| ysjl | 运输距离 | 整数 | 从起点到当前站的累计距离（公里） |
| xldm | 线路代码 | 整数 | 线路编码号 |
| sfytk | 是否要停靠 | 二进制 (0/1) | 1 表示列车必须停靠 |

---

## 数据表关系

```
    ┌──────────────┐
    │  客运站点表   │
    │ 主键: zdid   │
    └──────┬───────┘
           │ (外键)
    ┌──────┴──────┬──────────┐
    │             │          │
    ▼             ▼          ▼
 ┌──────────┐  ┌──────────┐  ┌──────────┐
 │运营线路   │  │高铁客运量 │  │  列车表   │
 │客运站表   │  │   表      │  │ 主键:    │
 │ 主键:    │  │ 外键:     │  │ lcbm    │
 │yyxlbm,  │  │yyxlbm,   │  └──────────┘
 │ zdid    │  │lcbm,zdid │
 └──────────┘  └──────────┘
```

---

## 数据量参考

| 表名 | 记录数 |
|------|-------|
| 高铁客运量表 | 100,000+ |
| 客运站点表 | 4,315 |
| 列车表 | 777 |
| 运营线路客运站表 | 11,340 |

---

## 使用建议

1. **数据导入顺序**：先导入维度表（站点、列车、线路）再导入事实表（高铁客运量）
2. **外键关系**：导入前应验证外键关系的完整性
3. **字符编码**：CSV 文件使用 UTF-8 编码
4. **标准标识**：使用 `station_telecode` 作为跨系统的站点标准标识

---

## 英文化数据文件

为便于在代码中使用，已将原始数据文件转换为英文命名版本，并删除了中文说明行（原第二行），保存在 [backend/db](../../backend/db) 目录下：

### 文件映射

| 原始文件（迁移数据） | 英文化文件（后端使用） | 大小 | 记录数 |
|------------------|------------------|------|-------|
| 高铁客运量（成都--重庆）...csv | [passenger_flow.csv](../../backend/db/passenger_flow.csv) | 68.92 MB | 100,000+ |
| 客运站点（站点名称...）.csv | [stations.csv](../../backend/db/stations.csv) | 0.16 MB | 4,314 |
| 列车表（列车编码...）.csv | [trains.csv](../../backend/db/trains.csv) | 0.01 MB | 776 |
| 运营线路客运站（运营线路...）.csv | [route_stations.csv](../../backend/db/route_stations.csv) | 0.42 MB | 11,339 |

### 文件处理说明

- **格式标准化**：每个文件只保留英文表头行，删除了原有的中文说明行
- **编码统一**：所有文件均使用 UTF-8 编码，确保跨平台兼容性
- **字段保持不变**：英文化文件的字段编码与原文件完全相同，便于数据映射
- **后端集成**：建议在 Django 数据加载流程中使用这些英文化文件

### 使用示例

在 Django 管理命令或 fixture 中加载这些文件：

```python
# 在 backend/data_management/services.py 中
from pathlib import Path

def load_data_from_backend_db():
    base_path = Path(__file__).parent.parent / 'db'
    
    stations_file = base_path / 'stations.csv'
    trains_file = base_path / 'trains.csv'
    routes_file = base_path / 'route_stations.csv'
    flows_file = base_path / 'passenger_flow.csv'
    
    # 按顺序加载维度表和事实表
    # ...
```

**更多信息**：Django ORM 迁移脚本存储在各个应用目录下（如 `backend/data_management/migrations/`）


