<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f9f9f9;
        }
        .test-section h2 {
            color: #555;
            margin-top: 0;
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            background: white;
            border: 1px solid #eee;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
            border-left: 4px solid #28a745;
        }
        .error {
            color: #dc3545;
            border-left: 4px solid #dc3545;
        }
        .loading {
            color: #6c757d;
            border-left: 4px solid #6c757d;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        .status-loading {
            background: #e2e3e5;
            color: #383d41;
        }
        .api-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .api-info h3 {
            margin-top: 0;
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å‰ç«¯APIé›†æˆæµ‹è¯•</h1>

        <div class="api-info">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>æ­¤é¡µé¢æµ‹è¯•å‰ç«¯Dashboardä¸APIæœåŠ¡çš„é›†æˆæƒ…å†µã€‚æµ‹è¯•åŒ…æ‹¬ï¼š</p>
            <ul>
                <li>APIæœåŠ¡å¯¼å…¥å’Œç±»å‹å®šä¹‰</li>
                <li>æ•°æ®æœåŠ¡è°ƒç”¨ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰</li>
                <li>æ—¶é—´èŒƒå›´å‚æ•°ä¼ é€’</li>
                <li>é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶</li>
            </ul>
            <p><strong>å½“å‰æ¨¡å¼ï¼š</strong> <span id="mode-status">æ­£åœ¨æ£€æµ‹...</span></p>
        </div>

        <div class="test-section">
            <h2>1. APIæœåŠ¡å¯¼å…¥æµ‹è¯•</h2>
            <p>æµ‹è¯•æ˜¯å¦æˆåŠŸå¯¼å…¥dataServiceå’ŒTypeScriptç±»å‹å®šä¹‰ã€‚</p>
            <button onclick="testApiImport()">è¿è¡Œæµ‹è¯•</button>
            <div id="import-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>2. KPIæ•°æ®è·å–æµ‹è¯•</h2>
            <p>æµ‹è¯•è·å–KPIæ•°æ®ï¼ˆä»Šæ—¥èŒƒå›´ï¼‰ã€‚</p>
            <button onclick="testKpiData()">è¿è¡Œæµ‹è¯•</button>
            <div id="kpi-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>3. ç«™ç‚¹æ•°æ®è·å–æµ‹è¯•</h2>
            <p>æµ‹è¯•è·å–ç«™ç‚¹æ•°æ®ï¼ˆæœ¬å‘¨èŒƒå›´ï¼‰ã€‚</p>
            <button onclick="testStationsData()">è¿è¡Œæµ‹è¯•</button>
            <div id="stations-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>4. è¶‹åŠ¿æ•°æ®è·å–æµ‹è¯•</h2>
            <p>æµ‹è¯•è·å–è¶‹åŠ¿æ•°æ®ï¼ˆå°æ—¶é¢‘ç‡ï¼‰ã€‚</p>
            <button onclick="testTrendData()">è¿è¡Œæµ‹è¯•</button>
            <div id="trend-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>5. ç»¼åˆé›†æˆæµ‹è¯•</h2>
            <p>æµ‹è¯•å®Œæ•´çš„æ•°æ®åŠ è½½æµç¨‹ï¼ˆå¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®ï¼‰ã€‚</p>
            <button onclick="testFullIntegration()">è¿è¡Œæµ‹è¯•</button>
            <div id="integration-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>6. ç¯å¢ƒå˜é‡æµ‹è¯•</h2>
            <p>æµ‹è¯•ç¯å¢ƒå˜é‡é…ç½®å’Œæ¨¡å¼åˆ‡æ¢ã€‚</p>
            <button onclick="testEnvironment()">è¿è¡Œæµ‹è¯•</button>
            <div id="env-result" class="test-result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸAPIæœåŠ¡
        const mockApiService = {
            getKpiData: async (timeRange) => {
                await new Promise(resolve => setTimeout(resolve, 300));
                return {
                    totalPassengers: 1245678,
                    totalTrains: 1234,
                    busyStations: 156,
                    totalRevenue: 8765432,
                    trends: {
                        totalPassengers: 12.5,
                        totalTrains: -3.2,
                        busyStations: 5.8,
                        totalRevenue: 18.3
                    }
                };
            },
            getStations: async (timeRange) => {
                await new Promise(resolve => setTimeout(resolve, 200));
                return [
                    {
                        id: 1,
                        name: 'æˆéƒ½ä¸œç«™',
                        code: 'CDW',
                        latitude: 30.6595,
                        longitude: 104.0659,
                        todayPassengers: 125678,
                        totalPassengers: 4567890,
                        occupancyRate: 92,
                        departures: 156,
                        arrivals: 148,
                        delayRate: 98,
                        connectedLines: ['æˆæ¸é«˜é“', 'æˆè´µé«˜é“', 'è¥¿æˆé«˜é“']
                    }
                ];
            },
            getTrendData: async (timeRange, frequency) => {
                await new Promise(resolve => setTimeout(resolve, 250));
                const data = [];
                for (let i = 0; i < 24; i++) {
                    data.push({
                        time: `${i.toString().padStart(2, '0')}:00`,
                        total: 5000 + Math.random() * 2000,
                        inbound: 3000 + Math.random() * 1000,
                        outbound: 2000 + Math.random() * 1000
                    });
                }
                return data;
            },
            refreshData: async (timeRange) => {
                await new Promise(resolve => setTimeout(resolve, 500));
                return { success: true, message: 'æ•°æ®åˆ·æ–°æˆåŠŸ' };
            }
        };

        // æµ‹è¯•å·¥å…·å‡½æ•°
        function setResult(elementId, content, className = '') {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.className = 'test-result ' + className;
        }

        function setStatus(elementId, text, type = 'loading') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = 'status status-' + type;
        }

        // æµ‹è¯•å‡½æ•°
        async function testApiImport() {
            setResult('import-result', 'æ­£åœ¨æµ‹è¯•APIå¯¼å…¥...', 'loading');

            try {
                // æ¨¡æ‹Ÿæµ‹è¯•
                await new Promise(resolve => setTimeout(resolve, 100));

                const testData = {
                    serviceAvailable: true,
                    typesAvailable: true,
                    mockServiceAvailable: true,
                    environmentDetection: true
                };

                setResult('import-result',
                    `âœ… APIå¯¼å…¥æµ‹è¯•æˆåŠŸï¼\n\næµ‹è¯•ç»“æœï¼š\n${JSON.stringify(testData, null, 2)}`,
                    'success');
                setStatus('mode-status', 'æ¨¡æ‹Ÿæ¨¡å¼', 'success');
            } catch (error) {
                setResult('import-result',
                    `âŒ APIå¯¼å…¥æµ‹è¯•å¤±è´¥ï¼š\n${error.message}\n\nå †æ ˆï¼š\n${error.stack}`,
                    'error');
                setStatus('mode-status', 'æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        async function testKpiData() {
            setResult('kpi-result', 'æ­£åœ¨è·å–KPIæ•°æ®...', 'loading');

            try {
                const timeRange = {
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: new Date().toISOString().split('T')[0],
                    rangeType: 'today'
                };

                const data = await mockApiService.getKpiData(timeRange);

                setResult('kpi-result',
                    `âœ… KPIæ•°æ®è·å–æˆåŠŸï¼\n\næ—¶é—´èŒƒå›´ï¼š${JSON.stringify(timeRange)}\n\nè¿”å›æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}`,
                    'success');
            } catch (error) {
                setResult('kpi-result',
                    `âŒ KPIæ•°æ®è·å–å¤±è´¥ï¼š\n${error.message}`,
                    'error');
            }
        }

        async function testStationsData() {
            setResult('stations-result', 'æ­£åœ¨è·å–ç«™ç‚¹æ•°æ®...', 'loading');

            try {
                const timeRange = {
                    startDate: '2024-01-01',
                    endDate: '2024-01-07',
                    rangeType: 'week'
                };

                const data = await mockApiService.getStations(timeRange);

                setResult('stations-result',
                    `âœ… ç«™ç‚¹æ•°æ®è·å–æˆåŠŸï¼\n\næ—¶é—´èŒƒå›´ï¼š${JSON.stringify(timeRange)}\n\nè¿”å›æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}`,
                    'success');
            } catch (error) {
                setResult('stations-result',
                    `âŒ ç«™ç‚¹æ•°æ®è·å–å¤±è´¥ï¼š\n${error.message}`,
                    'error');
            }
        }

        async function testTrendData() {
            setResult('trend-result', 'æ­£åœ¨è·å–è¶‹åŠ¿æ•°æ®...', 'loading');

            try {
                const timeRange = {
                    startDate: '2024-01-01',
                    endDate: '2024-01-01',
                    rangeType: 'today'
                };

                const data = await mockApiService.getTrendData(timeRange, 'hourly');

                setResult('trend-result',
                    `âœ… è¶‹åŠ¿æ•°æ®è·å–æˆåŠŸï¼\n\næ—¶é—´èŒƒå›´ï¼š${JSON.stringify(timeRange)}\né¢‘ç‡ï¼šhourly\n\næ•°æ®æ ·æœ¬ï¼ˆå‰5æ¡ï¼‰ï¼š\n${JSON.stringify(data.slice(0, 5), null, 2)}\n\næ€»è®¡ï¼š${data.length}æ¡è®°å½•`,
                    'success');
            } catch (error) {
                setResult('trend-result',
                    `âŒ è¶‹åŠ¿æ•°æ®è·å–å¤±è´¥ï¼š\n${error.message}`,
                    'error');
            }
        }

        async function testFullIntegration() {
            setResult('integration-result', 'æ­£åœ¨æ‰§è¡Œç»¼åˆé›†æˆæµ‹è¯•...', 'loading');

            try {
                const timeRange = {
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: new Date().toISOString().split('T')[0],
                    rangeType: 'today'
                };

                // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®
                const startTime = Date.now();
                const [kpiData, stationsData, trendData, refreshResult] = await Promise.all([
                    mockApiService.getKpiData(timeRange),
                    mockApiService.getStations(timeRange),
                    mockApiService.getTrendData(timeRange, 'hourly'),
                    mockApiService.refreshData(timeRange)
                ]);
                const endTime = Date.now();

                const result = {
                    æµ‹è¯•è€—æ—¶: `${endTime - startTime}ms`,
                    å¹¶è¡ŒåŠ è½½: 'æˆåŠŸ',
                    æ•°æ®å®Œæ•´æ€§: {
                        KPIæ•°æ®: Object.keys(kpiData).length > 0,
                        ç«™ç‚¹æ•°æ®: stationsData.length > 0,
                        è¶‹åŠ¿æ•°æ®: trendData.length > 0,
                        åˆ·æ–°æ“ä½œ: refreshResult.success
                    },
                    æ•°æ®æ ·æœ¬: {
                        KPI: kpiData,
                        ç«™ç‚¹: stationsData[0],
                        è¶‹åŠ¿: trendData.slice(0, 3)
                    }
                };

                setResult('integration-result',
                    `âœ… ç»¼åˆé›†æˆæµ‹è¯•æˆåŠŸï¼\n\n${JSON.stringify(result, null, 2)}`,
                    'success');
            } catch (error) {
                setResult('integration-result',
                    `âŒ ç»¼åˆé›†æˆæµ‹è¯•å¤±è´¥ï¼š\n${error.message}\n\nå †æ ˆï¼š\n${error.stack}`,
                    'error');
            }
        }

        async function testEnvironment() {
            setResult('env-result', 'æ­£åœ¨æµ‹è¯•ç¯å¢ƒé…ç½®...', 'loading');

            try {
                // æ¨¡æ‹Ÿç¯å¢ƒå˜é‡æ£€æµ‹
                const envVars = {
                    VITE_API_BASE_URL: window.location.origin.includes('localhost') ? 'http://localhost:8000/api' : 'æœªè®¾ç½®',
                    VITE_USE_MOCK: 'true',
                    å½“å‰ä¸»æœº: window.location.host,
                    å½“å‰åè®®: window.location.protocol,
                    ç”¨æˆ·ä»£ç†: navigator.userAgent.substring(0, 50) + '...'
                };

                const mode = envVars.VITE_USE_MOCK === 'true' ? 'æ¨¡æ‹Ÿæ¨¡å¼' : 'çœŸå®APIæ¨¡å¼';

                setResult('env-result',
                    `âœ… ç¯å¢ƒæµ‹è¯•å®Œæˆï¼\n\nå½“å‰æ¨¡å¼ï¼š${mode}\n\nç¯å¢ƒå˜é‡ï¼š\n${JSON.stringify(envVars, null, 2)}`,
                    'success');
            } catch (error) {
                setResult('env-result',
                    `âŒ ç¯å¢ƒæµ‹è¯•å¤±è´¥ï¼š\n${error.message}`,
                    'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
        window.onload = function() {
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const mode = isLocalhost ? 'å¼€å‘æ¨¡å¼ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰' : 'ç”Ÿäº§æ¨¡å¼';
            setStatus('mode-status', mode, isLocalhost ? 'loading' : 'success');
        };
    </script>
</body>
</html>